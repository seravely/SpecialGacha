<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>스페셜 뽑기판 (단일 HTML)</title>
  <style>
    :root{ --bg:#fff; --card:#fff; --muted:#64748b; --border:#e2e8f0; --shadow: 0 1px 2px rgba(15,23,42,.08); }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif; background:var(--bg); color:#0f172a; }
    .wrap{ max-width:1100px; margin:24px auto 60px; padding:0 16px; }
    h1{ margin:0 0 6px; font-size:34px; letter-spacing:-.02em; }
    .sub{ color:var(--muted); margin-bottom:18px; }
    .toprow{ display:flex; justify-content:space-between; align-items:flex-end; gap:12px; border-bottom:1px solid var(--border); padding-bottom:12px; margin-bottom:18px; }
    .status{ color:#0f172a; font-weight:700; }
    .status small{ font-weight:600; color:var(--muted); }
    .grid2{ display:grid; grid-template-columns: 1.05fr .95fr; gap:18px; align-items:start; }
    @media (max-width: 980px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:16px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:18px;
      letter-spacing:-.01em;
    }
    .cardHead{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:10px;
    }
    .hint{
      font-size:13px;
      color:var(--muted);
    }

    textarea{
      width:100%;
      min-height:160px;
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px 12px;
      resize:vertical;
      font-family:inherit;
      font-size:14px;
      line-height:1.45;
      outline:none;
      background:#fff;
    }
    textarea:focus{ border-color:#cbd5e1; box-shadow:0 0 0 3px rgba(99,102,241,.08); }

    .rowBtns{ display:flex; gap:10px; margin-top:12px; }
    button{
      border:none;
      border-radius:999px;
      padding:10px 14px;
      font-weight:800;
      cursor:pointer;
      background:#0f172a;
      color:#fff;
    }
    button.secondary{
      background:#fff;
      color:#0f172a;
      border:1px solid var(--border);
      font-weight:800;
    }
    button.ghost{
      background:#fff;
      color:#0f172a;
      border:1px solid var(--border);
      font-weight:800;
    }

    /* Remaining list */
    .remainBox{
      border:1px solid var(--border);
      border-radius:14px;
      background:#f8fafc;
      padding:12px;
    }
    .remainRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:6px 2px;
      gap:10px;
    }
    .remainRow .name{ font-weight:700; }
    .remainRow .cnt{ font-weight:900; }

    /* RGB panel */
    .rgbTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    .rgbTitle{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
    }
    .swatch{
      width:18px;
      height:18px;
      border-radius:6px;
      border:1px solid rgba(0,0,0,.12);
      background:rgb(90,160,240);
    }
    .rgbVal{
      font-size:13px;
      color:var(--muted);
      white-space:nowrap;
    }

    .rgbControls{
      margin-top:8px;
      display:grid;
      grid-template-columns: 34px 1fr 120px;
      gap:10px 12px;
      align-items:center;
    }
    .rgbControls label{
      font-weight:900;
      color:#0f172a;
    }
    .rgbControls input[type="range"]{
      width:100%;
    }
    .rgbControls input[type="number"]{
      width:100%;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      outline:none;
      font-size:14px;
      background:#fff;
    }
    .rgbActions{
      display:flex;
      gap:10px;
      margin-top:12px;
    }

    /* Board */
    .boardHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .boardMeta{
      font-size:13px;
      color:var(--muted);
      font-weight:700;
    }
    .boardWrap{
      border-radius:22px;
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      padding:14px;
      background:#fff;
    }

    /* Decorative frame behind grid */
    .frame{
      border-radius:22px;
      padding:18px;
      background: rgb(90, 160, 240);
      position:relative;
      overflow:hidden;
    }
    .frame:before{
      content:"";
      position:absolute; inset:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.45);
      pointer-events:none;
    }
    .frame:after{
      content:"";
      position:absolute; inset:22px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.35);
      pointer-events:none;
    }

    .tiles{
      position:relative;
      display:grid;
      gap:14px;
      /* columns set by JS */
    }

    .tile{
      position:relative;
      border-radius:18px;
      background: rgba(255,255,255,.35);
      box-shadow: 0 2px 0 rgba(0,0,0,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px;
      overflow:hidden;
    }
    .tile .txt{
      font-weight:900;
      color:#1d1d1f;
      letter-spacing:-.02em;
      text-align:center;
      line-height:1.15;
      display:block;
      width:100%;
      /* font-size set by JS for fit */
      word-break:keep-all;
      overflow-wrap:anywhere;
    }

    .tile.picked{
      background:#fff;
      box-shadow: 0 2px 0 rgba(0,0,0,.18);
    }
    .tile.picked .txt{
      color:#6b4b00; /* 텍스트 색상 (인덱스 참고 스타일) */
    }

    /* history */
    .historyHead{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .historyHint{ color:var(--muted); font-size:13px; font-weight:700; }
    .historyList{
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px;
      background:#fff;
      min-height:58px;
    }
    .historyItem{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 10px;
      border-radius:14px;
      background:#f8fafc;
      border:1px solid var(--border);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 14px;
      border-radius:999px;
      background:#fff;
      border:1px solid var(--border);
      font-weight:900;
    }

    /* PASSWORD GATE */
    #lock-screen{
      position:fixed; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap:12px;
      background:#fffbe6;
      z-index:9999;
    }
    #lock-screen input{
      padding:10px 12px; font-size:16px;
      border:1px solid var(--border);
      border-radius:12px;
      outline:none;
      min-width:260px;
    }
    #lock-screen button{
      padding:10px 14px;
    }

    /* Admin top bar/panel */
    #topbar{
      display:flex; justify-content:space-between; align-items:center;
      gap:12px; margin:10px 0 14px;
    }
    #adminLogs{
      display:none; margin:0 0 14px; padding:10px 12px;
      border:1px solid rgba(0,0,0,0.12); border-radius:10px;
      background:rgba(255,255,255,0.7);
    }
  </style>
</head>
<body>
  <!-- PASSWORD GATE -->
  <div id="lock-screen">
    <h2>접근 제한</h2>
    <input type="password" id="password" placeholder="비밀번호 입력" />
    <button onclick="checkPassword()">입장</button>
    <p id="error" style="color:red; display:none;">비밀번호가 틀렸어요</p>
  </div>

  <div id="site-content" style="display:none;">
    <div class="wrap">
      <div class="toprow">
        <div>
          <h1>스페셜 뽑기판</h1>
          <div class="sub">한 줄에 <b>상품명 갯수</b> (예: 하트 5) → Enter로 다음 품목</div>
        </div>
        <div class="status">진행: <span id="progress">0</span>/<span id="total">0</span> <small>(남음 <span id="remainTotal">0</span>)</small></div>
      </div>

      <div class="grid2">
        <!-- LEFT -->
        <div>
          <div class="card">
            <div class="cardHead">
              <h2>품목 입력</h2>
              <div class="hint">입력 합계: <b id="inputSum">0</b> · 칸 수: <b id="cellCount">0</b></div>
            </div>
            <textarea id="items" placeholder="예)
사랑 10
하트 5
초코 3"></textarea>

            <div class="rowBtns">
              <button id="btnBuild">뽑기판 생성/갱신</button>
              <button class="secondary" id="btnReset">초기화</button>
            </div>
          </div>

          <!-- 남은 갯수 -->
          <div class="card" style="margin-top:18px;">
            <div class="cardHead">
              <h2>남은 갯수</h2>
              <div class="hint">남은 칸: <b id="remainCells">0</b></div>
            </div>
            <div class="remainBox" id="remainBox"></div>
          </div>

          <!-- RGB 설정 -->
          <div class="card" style="margin-top:18px;">
            <div class="rgbTop">
              <button class="ghost" id="toggleRgb">설정 숨기기</button>
              <div class="rgbTitle">
                <span>뽑기판 색상 (RGB)</span>
                <span class="swatch" id="swatch"></span>
              </div>
              <div class="rgbVal" id="rgbLabel">rgb(90, 160, 240)</div>
            </div>

            <div id="rgbPanel">
              <div class="rgbControls">
                <label for="rRange">R</label>
                <input id="rRange" type="range" min="0" max="255" value="90">
                <input id="rNum" type="number" min="0" max="255" value="90">

                <label for="gRange">G</label>
                <input id="gRange" type="range" min="0" max="255" value="160">
                <input id="gNum" type="number" min="0" max="255" value="160">

                <label for="bRange">B</label>
                <input id="bRange" type="range" min="0" max="255" value="240">
                <input id="bNum" type="number" min="0" max="255" value="240">
              </div>

              <div class="rgbActions">
                <button class="secondary" id="btnRandom">랜덤 색상</button>
                <button class="secondary" id="btnWhite">흰색으로</button>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div>
          <!-- Top bar (welcome + logout) -->
          <div id="topbar">
            <div style="display:flex; flex-direction:column; gap:6px;">
              <div id="who-badge" style="font-size:12px; opacity:0.7;"></div>
              <div id="welcome" style="font-size:14px; font-weight:800; display:none;"></div>
            </div>
            <button id="logoutBtn" type="button" onclick="doLogout()" style="padding:6px 10px;">로그아웃</button>
          </div>

          <!-- Admin logs -->
          <div id="adminLogs">
            <div style="font-weight:800; margin-bottom:8px;">관리자: 로그인 기록</div>
            <div id="logList" style="font-size:12px; line-height:1.5; white-space:pre-wrap;"></div>
          </div>

          <div class="card">
            <div class="boardHeader">
              <h2>뽑기판</h2>
              <div class="boardMeta">칸 수: <b id="metaCells">0</b> · 열: <b id="metaCols">0</b></div>
            </div>
            <div class="boardWrap">
              <div class="frame" id="frame">
                <div class="tiles" id="tiles"></div>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:18px;">
            <div class="historyHead">
              <h2>뽑은 기록</h2>
              <div class="historyHint">최신이 아래</div>
            </div>
            <div class="historyList" id="history"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  /***********************
   *  설정(여기만 바꾸면 됨)
   ***********************/
  // ✅ Apps Script 웹앱 배포 후 받은 /exec URL을 여기에 붙여넣어!
  const LOG_ENDPOINT = "PASTE_YOUR_APPS_SCRIPT_EXEC_URL_HERE";

  // ✅ 관리자 로그 조회용 토큰(Apps Script 코드의 ADMIN_TOKEN과 동일하게)
  const ADMIN_TOKEN = "PASTE_YOUR_ADMIN_TOKEN_HERE";

  const USERS = {
    "Seravelyy!": { name: "세라", role: "admin" },
    "emo0205": { name: "에메모현", role: "user" }
  };

  /* ====== app state ====== */
  let itemsMap = new Map();   // name -> count
  let pool = [];             // expanded labels
  let picked = [];           // history labels
  let currentColor = { r:90, g:160, b:240 };
  let cols = 10;             // computed
  let totalCells = 0;

  function showWelcome(name){
    const welcome = document.getElementById("welcome");
    if (!welcome) return;
    welcome.textContent = `${name}님 환영합니다!`;
    welcome.style.display = "block";
    setTimeout(()=>{ welcome.style.display = "none"; }, 2500);
  }

  function sendLoginLog(name){
    if (!LOG_ENDPOINT || LOG_ENDPOINT.includes("PASTE_YOUR_")) return;
    fetch(LOG_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, ua: navigator.userAgent })
    }).catch(()=>{});
  }

  async function loadLogsForAdmin(){
    const role = sessionStorage.getItem("role");
    if (role !== "admin") return;

    const panel = document.getElementById("adminLogs");
    const list = document.getElementById("logList");
    if (!panel || !list) return;

    if (!LOG_ENDPOINT || LOG_ENDPOINT.includes("PASTE_YOUR_") ||
        !ADMIN_TOKEN || ADMIN_TOKEN.includes("PASTE_YOUR_")){
      panel.style.display = "none";
      return;
    }

    try{
      const res = await fetch(`${LOG_ENDPOINT}?token=${encodeURIComponent(ADMIN_TOKEN)}`);
      const text = await res.text();
      let data;
      try { data = JSON.parse(text); } catch(e){ data = null; }

      panel.style.display = "block";

      if (!Array.isArray(data)){
        list.textContent = "로그 조회 응답이 JSON 배열이 아니에요.\n" + text;
        return;
      }
      if (data.length === 0){
        list.textContent = "기록 없음";
        return;
      }

      list.textContent = data.map(x => `- ${x.name || "unknown"} / ${x.time || ""}`).join("\n");
    } catch(e){
      panel.style.display = "block";
      list.textContent = "로그를 불러오지 못했어요. (URL/권한/토큰 확인)\n" + String(e);
    }
  }

  function unlockAs(user){
    document.getElementById("lock-screen").style.display = "none";
    document.getElementById("site-content").style.display = "block";
    sessionStorage.setItem("unlocked", "true");
    sessionStorage.setItem("who", user.name);
    sessionStorage.setItem("role", user.role || "user");

    const badge = document.getElementById("who-badge");
    if (badge) badge.textContent = `${user.name} 님 접속`;

    showWelcome(user.name);
    sendLoginLog(user.name);
    loadLogsForAdmin();
  }

  function checkPassword() {
    const input = document.getElementById("password").value.trim();
    const user = USERS[input];

    if (user) {
      unlockAs(user);
    } else {
      document.getElementById("error").style.display = "block";
    }
  }

  function doLogout(){
    sessionStorage.removeItem("unlocked");
    sessionStorage.removeItem("who");
    sessionStorage.removeItem("role");
    document.getElementById("site-content").style.display = "none";
    const lock = document.getElementById("lock-screen");
    lock.style.display = "flex";
    document.getElementById("password").value = "";
    document.getElementById("error").style.display = "none";
  }

  if (sessionStorage.getItem("unlocked") === "true") {
    const who = sessionStorage.getItem("who");
    const role = sessionStorage.getItem("role") || "user";
    document.getElementById("lock-screen").style.display = "none";
    document.getElementById("site-content").style.display = "block";
    const badge = document.getElementById("who-badge");
    if (badge && who) badge.textContent = `${who} 님 접속`;
    sessionStorage.setItem("role", role);
    loadLogsForAdmin();
  }

  window.addEventListener("load", ()=>{
    const pw = document.getElementById("password");
    if (pw){
      pw.addEventListener("keydown", (e)=>{
        if (e.key === "Enter") checkPassword();
      });
    }
  });

  /* ====== parsing ====== */
  function parseItems(text){
    const map = new Map();
    const lines = text.split(/\r?\n/).map(x=>x.trim()).filter(Boolean);
    for (const line of lines){
      const m = line.match(/^(.+?)\s+(\d+)$/);
      if (!m) continue;
      const name = m[1].trim();
      const cnt = parseInt(m[2],10);
      if (!name || !Number.isFinite(cnt) || cnt<=0) continue;
      map.set(name, (map.get(name)||0) + cnt);
    }
    return map;
  }

  function rebuildPool(){
    pool = [];
    itemsMap.forEach((cnt, name)=>{
      for (let i=0;i<cnt;i++) pool.push(name);
    });
    totalCells = pool.length;
  }

  /* ====== layout ====== */
  function computeCols(total){
    if (total<=0) return 0;
    // 기본 10열 기준, 너무 작으면 4열
    if (total <= 20) return Math.min(10, Math.max(4, Math.ceil(Math.sqrt(total))));
    return 10;
  }

  function applyFrameColor(){
    const frame = document.getElementById("frame");
    frame.style.background = `rgb(${currentColor.r}, ${currentColor.g}, ${currentColor.b})`;
    document.getElementById("rgbLabel").textContent = `rgb(${currentColor.r}, ${currentColor.g}, ${currentColor.b})`;
    document.getElementById("swatch").style.background = `rgb(${currentColor.r}, ${currentColor.g}, ${currentColor.b})`;
  }

  function tileFontSizeForText(text, tileW){
    // 기본 비율: 숫자는 크게, 한글은 길면 줄바꿈 + 축소
    // 타일 너비 대비 대략적인 기준 폰트 크기 (인덱스 스타일 비슷하게)
    const base = Math.max(12, Math.floor(tileW * 0.24)); // 24%
    const min = Math.max(10, Math.floor(tileW * 0.14));  // 14%
    if (!text) return base;

    // 글자 길이에 따라 축소
    const len = String(text).length;
    let size = base;
    if (len >= 6) size = Math.floor(base * 0.80);
    if (len >= 10) size = Math.floor(base * 0.68);
    if (len >= 14) size = Math.floor(base * 0.58);
    size = Math.max(min, size);
    return size;
  }

  function renderTiles(){
    const tilesEl = document.getElementById("tiles");
    tilesEl.innerHTML = "";

    cols = computeCols(totalCells);
    tilesEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

    // 계산용: 타일 크기 추정
    // 프레임 내부는 padding + gap이 있으니 대략적인 폭으로 계산
    const frame = document.getElementById("frame");
    const frameRect = frame.getBoundingClientRect();
    const padding = 18*2; // frame padding
    const gap = 14;
    const innerW = Math.max(200, frameRect.width - padding);
    const tileW = Math.floor((innerW - gap*(cols-1)) / cols);

    for (let i=0;i<pool.length;i++){
      const div = document.createElement("div");
      div.className = "tile";
      div.dataset.idx = String(i);

      const span = document.createElement("span");
      span.className = "txt";

      // 기본: 숫자 표시
      span.textContent = String(i+1);

      const fs = tileFontSizeForText(span.textContent, tileW);
      span.style.fontSize = fs + "px";

      div.appendChild(span);

      div.addEventListener("click", ()=>pickOne(i));
      tilesEl.appendChild(div);
    }

    // meta
    document.getElementById("metaCells").textContent = String(totalCells);
    document.getElementById("metaCols").textContent = String(cols);

    updateStats();
  }

  function setTilePicked(idx, label){
    const tile = document.querySelector(`.tile[data-idx="${idx}"]`);
    if (!tile) return;
    tile.classList.add("picked");
    const span = tile.querySelector(".txt");
    span.textContent = label;

    // 타일 크기에 맞춰 폰트 다시 계산 + 줄바꿈 적용
    // 타일 실측
    const rect = tile.getBoundingClientRect();
    const fs = tileFontSizeForText(label, rect.width);
    span.style.fontSize = fs + "px";

    // 줄바꿈 유도(필요 시)
    span.style.whiteSpace = "pre-wrap";
  }

  /* ====== draw logic ====== */
  function pickOne(idx){
    // 이미 뽑힌 칸이면 무시
    const tile = document.querySelector(`.tile[data-idx="${idx}"]`);
    if (tile && tile.classList.contains("picked")) return;

    if (pool.length === 0) return;

    // 해당 칸에 랜덤 라벨 배정
    const r = Math.floor(Math.random() * pool.length);
    const label = pool.splice(r,1)[0];

    setTilePicked(idx, label);
    picked.push(label);

    updateRemain();
    renderHistory();
    updateStats();
  }

  function updateStats(){
    document.getElementById("progress").textContent = String(picked.length);
    document.getElementById("total").textContent = String(totalCells);
    document.getElementById("remainTotal").textContent = String(totalCells - picked.length);
    document.getElementById("remainCells").textContent = String(totalCells - picked.length);
  }

  function updateRemain(){
    const remainMap = new Map();
    for (const name of pool){
      remainMap.set(name, (remainMap.get(name)||0)+1);
    }

    const box = document.getElementById("remainBox");
    box.innerHTML = "";
    if (remainMap.size === 0){
      box.innerHTML = `<div class="remainRow"><div class="name">없음</div><div class="cnt">0</div></div>`;
      return;
    }

    // 원래 입력 순서 유지
    itemsMap.forEach((_, name)=>{
      const cnt = remainMap.get(name) || 0;
      const row = document.createElement("div");
      row.className = "remainRow";
      row.innerHTML = `<div class="name">${escapeHtml(name)}</div><div class="cnt">${cnt}</div>`;
      box.appendChild(row);
    });
  }

  function renderHistory(){
    const el = document.getElementById("history");
    el.innerHTML = "";
    if (picked.length === 0){
      el.innerHTML = `<div class="historyItem"><div class="hint">아직 없음</div><div class="pill">-</div></div>`;
      return;
    }
    const last = picked[picked.length-1];
    const item = document.createElement("div");
    item.className = "historyItem";
    item.innerHTML = `<div class="hint">#${picked.length}</div><div class="pill">${escapeHtml(last)}</div>`;
    el.appendChild(item);
  }

  function escapeHtml(str){
    return String(str)
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&#039;");
  }

  /* ====== UI handlers ====== */
  const itemsEl = document.getElementById("items");
  const btnBuild = document.getElementById("btnBuild");
  const btnReset = document.getElementById("btnReset");

  btnBuild.addEventListener("click", ()=>{
    itemsMap = parseItems(itemsEl.value);
    rebuildPool();
    picked = [];
    document.getElementById("inputSum").textContent = String(pool.length);
    document.getElementById("cellCount").textContent = String(pool.length);
    updateRemain();
    renderHistory();
    renderTiles();
  });

  btnReset.addEventListener("click", ()=>{
    itemsEl.value = "";
    itemsMap = new Map();
    pool = [];
    picked = [];
    totalCells = 0;
    document.getElementById("inputSum").textContent = "0";
    document.getElementById("cellCount").textContent = "0";
    document.getElementById("metaCells").textContent = "0";
    document.getElementById("metaCols").textContent = "0";
    document.getElementById("tiles").innerHTML = "";
    updateRemain();
    renderHistory();
    updateStats();
  });

  // RGB bind
  const rRange = document.getElementById("rRange");
  const gRange = document.getElementById("gRange");
  const bRange = document.getElementById("bRange");
  const rNum = document.getElementById("rNum");
  const gNum = document.getElementById("gNum");
  const bNum = document.getElementById("bNum");

  function syncRGB(){
    currentColor = { r:+rRange.value, g:+gRange.value, b:+bRange.value };
    rNum.value = currentColor.r;
    gNum.value = currentColor.g;
    bNum.value = currentColor.b;
    applyFrameColor();
  }
  function syncFromNum(){
    currentColor = { r:+rNum.value, g:+gNum.value, b:+bNum.value };
    rRange.value = currentColor.r;
    gRange.value = currentColor.g;
    bRange.value = currentColor.b;
    applyFrameColor();
  }
  rRange.addEventListener("input", syncRGB);
  gRange.addEventListener("input", syncRGB);
  bRange.addEventListener("input", syncRGB);
  rNum.addEventListener("input", syncFromNum);
  gNum.addEventListener("input", syncFromNum);
  bNum.addEventListener("input", syncFromNum);

  document.getElementById("btnRandom").addEventListener("click", ()=>{
    rRange.value = Math.floor(Math.random()*256);
    gRange.value = Math.floor(Math.random()*256);
    bRange.value = Math.floor(Math.random()*256);
    syncRGB();
  });
  document.getElementById("btnWhite").addEventListener("click", ()=>{
    rRange.value = 255; gRange.value = 255; bRange.value = 255;
    syncRGB();
  });

  // RGB panel toggle
  const toggleBtn = document.getElementById("toggleRgb");
  const rgbPanel = document.getElementById("rgbPanel");
  let rgbHidden = false;
  toggleBtn.addEventListener("click", ()=>{
    rgbHidden = !rgbHidden;
    if (rgbHidden){
      rgbPanel.style.display = "none";
      toggleBtn.textContent = "설정 열기";
    } else {
      rgbPanel.style.display = "block";
      toggleBtn.textContent = "설정 숨기기";
    }
  });

  // init remain box + history
  updateRemain();
  renderHistory();
  applyFrameColor();

  // resize re-render fonts on window resize
  window.addEventListener("resize", ()=>{
    if (totalCells>0) renderTiles();
  });
</script>
</body>
</html>

